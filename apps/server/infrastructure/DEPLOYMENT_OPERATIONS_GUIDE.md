# ë°°í¬ ë° ìš´ì˜ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” Hanbit TODO ì•±ì˜ ë°°í¬ ëª¨ë‹ˆí„°ë§, ì•Œë¦¼ ì‹œìŠ¤í…œ, ë¡¤ë°± ì „ëµì„ í¬í•¨í•œ ì™„ì „í•œ ìš´ì˜ ì‹œìŠ¤í…œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ë°°í¬ ëª¨ë‹ˆí„°ë§](#ë°°í¬-ëª¨ë‹ˆí„°ë§)
3. [ì•Œë¦¼ ì‹œìŠ¤í…œ](#ì•Œë¦¼-ì‹œìŠ¤í…œ)
4. [ë¡¤ë°± ì „ëµ](#ë¡¤ë°±-ì „ëµ)
5. [ë°°í¬ ë©”íŠ¸ë¦­](#ë°°í¬-ë©”íŠ¸ë¦­)
6. [ìš´ì˜ ê°€ì´ë“œ](#ìš´ì˜-ê°€ì´ë“œ)
7. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

## ğŸ—ï¸ ì‹œìŠ¤í…œ ê°œìš”

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub        â”‚    â”‚   AWS Lambda     â”‚    â”‚   CloudWatch    â”‚
â”‚   Actions       â”‚â”€â”€â”€â”€â–¶   Functions     â”‚â”€â”€â”€â”€â–¶   Monitoring   â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DynamoDB      â”‚    â”‚   SNS Topics     â”‚    â”‚   Slack/Email   â”‚
â”‚   History       â”‚    â”‚   Alerts         â”‚    â”‚   Notifications â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸

1. **ë°°í¬ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ**
   - ì‹¤ì‹œê°„ í—¬ìŠ¤ì²´í¬
   - ìë™ ë¡¤ë°± ê°ì§€
   - ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘

2. **ì•Œë¦¼ ì‹œìŠ¤í…œ**
   - ì´ë©”ì¼ ì•Œë¦¼ (SNS)
   - Slack í†µí•©
   - ë‹¤ë‹¨ê³„ ì•Œë¦¼ ì „ëµ

3. **ë°°í¬ íˆìŠ¤í† ë¦¬**
   - DynamoDB ê¸°ë°˜ ì¶”ì 
   - APIë¥¼ í†µí•œ ì¡°íšŒ
   - 90ì¼ ìë™ ë³´ê´€

4. **ìë™ ë¡¤ë°±**
   - ì‹¤íŒ¨ ê°ì§€ ì‹œ ìë™ íŠ¸ë¦¬ê±°
   - Git ì»¤ë°‹ ê¸°ë°˜ ë³µì›
   - í—¬ìŠ¤ì²´í¬ ê²€ì¦

## ğŸ“Š ë°°í¬ ëª¨ë‹ˆí„°ë§

### CloudWatch ëŒ€ì‹œë³´ë“œ

ê° í™˜ê²½ë³„ë¡œ ì „ìš© ëŒ€ì‹œë³´ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤:

- `deployment-monitoring-dev`
- `deployment-monitoring-test`
- `deployment-monitoring-prod`

### ì£¼ìš” ë©”íŠ¸ë¦­

1. **ë°°í¬ ì„±ê³µë¥ **
   - ì´ ë°°í¬ íšŸìˆ˜
   - ì„±ê³µ/ì‹¤íŒ¨ ë¹„ìœ¨
   - í‰ê·  ë°°í¬ ì‹œê°„

2. **Lambda í•¨ìˆ˜ ì„±ëŠ¥**
   - ì—ëŸ¬ìœ¨
   - ì‘ë‹µ ì‹œê°„
   - ë™ì‹œ ì‹¤í–‰ ìˆ˜

3. **API Gateway ë©”íŠ¸ë¦­**
   - 5XX ì—ëŸ¬ìœ¨
   - í‰ê·  ì‘ë‹µ ì‹œê°„
   - ìš”ì²­ ìˆ˜

### ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ë°©ë²•

```bash
# CDK ì¶œë ¥ì—ì„œ ëŒ€ì‹œë³´ë“œ URL í™•ì¸
aws cloudformation describe-stacks \
  --stack-name HanbitTodoStack-prod \
  --query 'Stacks[0].Outputs[?OutputKey==`DeploymentDashboardUrlProd`].OutputValue' \
  --output text
```

## ğŸ”” ì•Œë¦¼ ì‹œìŠ¤í…œ

### ì´ë©”ì¼ ì•Œë¦¼ (SNS)

#### ì„¤ì • ë°©ë²•

```typescript
// environment.tsì—ì„œ ì„¤ì •
monitoring: {
  alertEmail: "ops-team@company.com",
  // ...
}
```

#### ì•Œë¦¼ ìœ í˜•

- âœ… ë°°í¬ ì„±ê³µ
- âŒ ë°°í¬ ì‹¤íŒ¨
- âš ï¸ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨
- ğŸ”„ ìë™ ë¡¤ë°± ì‹œì‘/ì™„ë£Œ

### Slack í†µí•©

#### Webhook URL ì„¤ì •

```bash
# í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •
export SLACK_WEBHOOK_URL="https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX"

# ë˜ëŠ” environment.tsì—ì„œ ì„¤ì •
monitoring: {
  slackWebhookUrl: process.env.SLACK_WEBHOOK_URL,
  // ...
}
```

#### ì•Œë¦¼ ì˜ˆì‹œ

```json
{
  "text": "ğŸš¨ í”„ë¡œë•ì…˜ ë°°í¬ ì‹¤íŒ¨!",
  "attachments": [
    {
      "color": "danger",
      "fields": [
        { "title": "ë°°í¬ ID", "value": "deploy-20241212-143052-a1b2c3d4", "short": true },
        { "title": "í™˜ê²½", "value": "prod", "short": true },
        { "title": "ì»¤ë°‹", "value": "a1b2c3d4", "short": true },
        { "title": "ë°°í¬ì", "value": "developer", "short": true }
      ]
    }
  ]
}
```

## ğŸ”„ ë¡¤ë°± ì „ëµ

### ìë™ ë¡¤ë°±

#### íŠ¸ë¦¬ê±° ì¡°ê±´

1. í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ (ì—°ì† 2íšŒ)
2. Lambda í•¨ìˆ˜ ì—ëŸ¬ìœ¨ > 5%
3. API Gateway 5XX ì—ëŸ¬ìœ¨ > 10%

#### ë¡¤ë°± í”„ë¡œì„¸ìŠ¤

```mermaid
flowchart TD
    A[ë°°í¬ ì‹¤íŒ¨ ê°ì§€] --> B[í˜„ì¬ ìƒíƒœ ë°±ì—…]
    B --> C[ë¡¤ë°± ëŒ€ìƒ í™•ì¸]
    C --> D[Git ì»¤ë°‹ ê¸°ë°˜ ë¡¤ë°±]
    D --> E[CDK ì¬ë°°í¬]
    E --> F[í—¬ìŠ¤ì²´í¬ ìˆ˜í–‰]
    F --> G{í—¬ìŠ¤ì²´í¬ ì„±ê³µ?}
    G -->|Yes| H[ë¡¤ë°± ì™„ë£Œ ì•Œë¦¼]
    G -->|No| I[ìˆ˜ë™ ê°œì… í•„ìš” ì•Œë¦¼]
```

### ìˆ˜ë™ ë¡¤ë°±

#### ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

```bash
# ìµœê·¼ ì„±ê³µí•œ ë°°í¬ ëª©ë¡ í™•ì¸
cd apps/server/infrastructure/scripts
./deployment-metrics.sh prod 7

# íŠ¹ì • ë°°í¬ë¡œ ë¡¤ë°±
./rollback-deployment.sh prod deploy-20241212-120000-x1y2z3w4
```

#### GitHub Actionsë¥¼ í†µí•œ ë¡¤ë°±

```yaml
# workflow_dispatchë¡œ ìˆ˜ë™ íŠ¸ë¦¬ê±°
deployment_type: rollback
rollback_target: deploy-20241212-120000-x1y2z3w4
```

## ğŸ“ˆ ë°°í¬ ë©”íŠ¸ë¦­

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘

#### ìë™ ìˆ˜ì§‘

- ë°°í¬ ì´ë²¤íŠ¸ë§ˆë‹¤ DynamoDBì— ìë™ ê¸°ë¡
- CloudWatch ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ìœ¼ë¡œ ì „ì†¡
- ì•Œë¦¼ ë°œìƒ ì‹œ ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸

#### ìˆ˜ë™ ìˆ˜ì§‘

```bash
# ë°°í¬ ë©”íŠ¸ë¦­ ë¦¬í¬íŠ¸ ìƒì„±
cd apps/server/infrastructure/scripts
./deployment-metrics.sh prod 30

# ìƒì„±ëœ ë¦¬í¬íŠ¸ í™•ì¸
ls reports/
```

### ë¦¬í¬íŠ¸ íŒŒì¼

1. **deployment-stats-{env}-{timestamp}.json**

   ```json
   {
     "stats": {
       "totalDeployments": 45,
       "successfulDeployments": 43,
       "failedDeployments": 2,
       "successRate": 95.56,
       "averageDuration": 180
     },
     "recentTrends": {
       "last7Days": {...},
       "last30Days": {...}
     }
   }
   ```

2. **cloudwatch-metrics-{env}-{timestamp}.json**
   - Lambda í•¨ìˆ˜ë³„ ì—ëŸ¬/ì„±ëŠ¥ ë©”íŠ¸ë¦­
   - API Gateway ë©”íŠ¸ë¦­
   - ì‹œê°„ëŒ€ë³„ ìƒì„¸ ë°ì´í„°

3. **deployment-summary-{env}-{timestamp}.md**
   - í•œëˆˆì— ë³´ëŠ” ìš”ì•½ ë¦¬í¬íŠ¸
   - ê¶Œì¥ì‚¬í•­ í¬í•¨
   - ë§ˆí¬ë‹¤ìš´ í˜•ì‹

### APIë¥¼ í†µí•œ ì¡°íšŒ

```bash
# ìµœê·¼ ë°°í¬ íˆìŠ¤í† ë¦¬ ì¡°íšŒ
curl -X GET "https://your-api.com/deployment/history?limit=10"

# ë°°í¬ í†µê³„ ì¡°íšŒ
curl -X GET "https://your-api.com/deployment/stats?period=30"

# íŠ¹ì • ë°°í¬ ìƒì„¸ ì •ë³´
curl -X GET "https://your-api.com/deployment/history/deploy-20241212-120000"
```

## ğŸ› ï¸ ìš´ì˜ ê°€ì´ë“œ

### ì¼ì¼ ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ì˜¤ì „ ì²´í¬ (09:00)

- [ ] ì•¼ê°„ ë°°í¬ ê²°ê³¼ í™•ì¸
- [ ] CloudWatch ì•ŒëŒ ìƒíƒœ ì ê²€
- [ ] ë°°í¬ ë©”íŠ¸ë¦­ ë¦¬í¬íŠ¸ ê²€í† 

#### ì˜¤í›„ ì²´í¬ (14:00)

- [ ] ë°°í¬ ëŒ€ê¸° ì¤‘ì¸ PR í™•ì¸
- [ ] ì‹œìŠ¤í…œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- [ ] ì•Œë¦¼ ì„¤ì • ìƒíƒœ í™•ì¸

#### ì£¼ê°„ ì‘ì—… (ë§¤ì£¼ ì›”ìš”ì¼)

- [ ] ì£¼ê°„ ë°°í¬ ë¦¬í¬íŠ¸ ìƒì„±
- [ ] ì‹¤íŒ¨í•œ ë°°í¬ ì›ì¸ ë¶„ì„
- [ ] ë°°í¬ í”„ë¡œì„¸ìŠ¤ ê°œì„  ì‚¬í•­ ê²€í† 

### í™˜ê²½ë³„ ë°°í¬ ì ˆì°¨

#### ê°œë°œ í™˜ê²½ (development)

```bash
# ìë™ ë°°í¬ (main ë¸Œëœì¹˜ push ì‹œ)
git push origin main

# ìˆ˜ë™ ë°°í¬
cd apps/server/infrastructure
cdk deploy HanbitTodoStack-development
```

#### í…ŒìŠ¤íŠ¸ í™˜ê²½ (test)

```bash
# GitHub Actions ìˆ˜ë™ íŠ¸ë¦¬ê±°
# Repository â†’ Actions â†’ "Deploy to Test" â†’ Run workflow
```

#### í”„ë¡œë•ì…˜ í™˜ê²½ (production)

```bash
# ìŠ¹ì¸ í•„ìš”í•œ ë°°í¬
# Repository â†’ Actions â†’ "í”„ë¡œë•ì…˜ ë°°í¬ ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°" â†’ Run workflow
# â†’ ìŠ¹ì¸ ëŒ€ê¸° â†’ Environment approval â†’ ë°°í¬ ì§„í–‰
```

### ê¸´ê¸‰ ìƒí™© ëŒ€ì‘

#### ì„œë¹„ìŠ¤ ì¥ì•  ì‹œ

1. **ì¦‰ì‹œ ë¡¤ë°±**

   ```bash
   # ìµœê·¼ ì„±ê³µí•œ ë°°í¬ë¡œ ë¡¤ë°±
   ./rollback-deployment.sh prod [ë§ˆì§€ë§‰_ì„±ê³µ_ë°°í¬_ID]
   ```

2. **í•«í”½ìŠ¤ ë°°í¬**

   ```yaml
   # GitHub Actionsì—ì„œ í•«í”½ìŠ¤ ë°°í¬
   deployment_type: hotfix
   force_deploy: true
   ```

3. **ìˆ˜ë™ ê°œì…**
   - AWS ì½˜ì†”ì—ì„œ ì§ì ‘ ì¡°ì¹˜
   - CloudFormation ìŠ¤íƒ ìƒíƒœ í™•ì¸
   - Lambda í•¨ìˆ˜ ê°œë³„ ì ê²€

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ

#### 1. ë°°í¬ ì‹¤íŒ¨

**ì¦ìƒ**: CDK ë°°í¬ ì¤‘ ì—ëŸ¬ ë°œìƒ

```bash
# í•´ê²° ë°©ë²•
1. CloudFormation ìŠ¤íƒ ì´ë²¤íŠ¸ í™•ì¸
aws cloudformation describe-stack-events --stack-name HanbitTodoStack-prod

2. Lambda í•¨ìˆ˜ ë¡œê·¸ í™•ì¸
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/HanbitTodoStack"

3. í•„ìš”ì‹œ ìˆ˜ë™ ì •ë¦¬ í›„ ì¬ë°°í¬
cdk destroy HanbitTodoStack-prod
cdk deploy HanbitTodoStack-prod
```

#### 2. í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨

**ì¦ìƒ**: ë°°í¬ í›„ í—¬ìŠ¤ì²´í¬ê°€ ì§€ì†ì ìœ¼ë¡œ ì‹¤íŒ¨

```bash
# í•´ê²° ë°©ë²•
1. API Gateway ì—”ë“œí¬ì¸íŠ¸ ìƒíƒœ í™•ì¸
curl -v https://your-api.com/health

2. Lambda í•¨ìˆ˜ ì‹¤í–‰ ë¡œê·¸ í™•ì¸
aws logs tail /aws/lambda/HanbitTodoStack-prod-Lambda-CreateTodoFunction

3. DynamoDB í…Œì´ë¸” ìƒíƒœ í™•ì¸
aws dynamodb describe-table --table-name todos-prod
```

#### 3. ì•Œë¦¼ ë¯¸ìˆ˜ì‹ 

**ì¦ìƒ**: ë°°í¬ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼ì´ ì˜¤ì§€ ì•ŠìŒ

```bash
# í•´ê²° ë°©ë²•
1. SNS í† í”½ êµ¬ë… ìƒíƒœ í™•ì¸
aws sns list-subscriptions-by-topic --topic-arn arn:aws:sns:...

2. Slack Webhook URL ìœ íš¨ì„± í™•ì¸
curl -X POST -H 'Content-type: application/json' \
  --data '{"text":"í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€"}' \
  $SLACK_WEBHOOK_URL

3. Lambda í•¨ìˆ˜ ì‹¤í–‰ ê¶Œí•œ í™•ì¸
aws iam list-attached-role-policies --role-name HanbitTodoStack-prod-...
```

### ë¡œê·¸ ë¶„ì„

#### CloudWatch Logs ì¿¼ë¦¬

```bash
# ë°°í¬ ê´€ë ¨ ì—ëŸ¬ ê²€ìƒ‰
aws logs start-query \
  --log-group-name "/aws/lambda/HanbitTodoStack-prod-DeploymentMonitoring-HealthCheckFunction" \
  --start-time 1702339200 \
  --end-time 1702342800 \
  --query-string 'fields @timestamp, @message | filter @message like /ERROR/'
```

#### ë°°í¬ ì‹¤íŒ¨ íŒ¨í„´ ë¶„ì„

```sql
-- CloudWatch Logs Insights ì¿¼ë¦¬
fields @timestamp, @message
| filter @message like /deployment/
| filter @message like /failed/
| stats count() by bin(5m)
```

### ì„±ëŠ¥ ìµœì í™”

#### Lambda í•¨ìˆ˜ ìµœì í™”

```typescript
// ì½œë“œ ìŠ¤íƒ€íŠ¸ ìµœì†Œí™”
const client = new DynamoDBClient({}); // í•¨ìˆ˜ ì™¸ë¶€ì—ì„œ ì´ˆê¸°í™”

export const handler = async event => {
  // í•¸ë“¤ëŸ¬ ë‚´ë¶€ëŠ” ìµœì†Œí™”
};
```

#### DynamoDB ìµœì í™”

```bash
# ì½ê¸°/ì“°ê¸° ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
aws cloudwatch get-metric-statistics \
  --namespace AWS/DynamoDB \
  --metric-name ConsumedReadCapacityUnits \
  --dimensions Name=TableName,Value=deployment-history-prod
```

## ğŸ“š ì°¸ê³  ìë£Œ

### AWS ë¬¸ì„œ

- [CloudWatch ëŒ€ì‹œë³´ë“œ ê°€ì´ë“œ](https://docs.aws.amazon.com/cloudwatch/latest/monitoring/CloudWatch_Dashboards.html)
- [SNS ì•Œë¦¼ ì„¤ì •](https://docs.aws.amazon.com/sns/latest/dg/sns-email-notifications.html)
- [Lambda ëª¨ë‹ˆí„°ë§](https://docs.aws.amazon.com/lambda/latest/dg/lambda-monitoring.html)

### ë‚´ë¶€ ë¬¸ì„œ

- [CDK ë°°í¬ ê°€ì´ë“œ](./README.md)
- [í™˜ê²½ ì„¤ì • ê°€ì´ë“œ](./config/README.md)
- [ë³´ì•ˆ ì„¤ì • ê°€ì´ë“œ](./SECURITY.md)

### ìŠ¤í¬ë¦½íŠ¸ ë° ë„êµ¬

- `deployment-metrics.sh` - ë°°í¬ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- `rollback-deployment.sh` - ìˆ˜ë™ ë¡¤ë°± ì‹¤í–‰
- GitHub Actions ì›Œí¬í”Œë¡œìš° - `.github/workflows/`

---

## ğŸš¨ ê¸´ê¸‰ ì—°ë½ì²˜

**ê°œë°œíŒ€**: dev-team@company.com  
**ìš´ì˜íŒ€**: ops-team@company.com  
**ë³´ì•ˆíŒ€**: security-team@company.com

**24ì‹œê°„ ëŒ€ì‘**: +82-10-XXXX-XXXX  
**Slack ì±„ë„**: #hanbit-todo-ops

---

_ì´ ë¬¸ì„œëŠ” ì •ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2024-12-12_
