name: CI/CD Pipeline

on:
  push:
    branches:
      - main
      - develop
      - "feature/*"
  pull_request:
    branches:
      - main
      - develop

env:
  NODE_VERSION: "20"
  PNPM_VERSION: "10.13.1"

jobs:
  # í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì • ê²€ì¦
  validate-environment:
    name: í™˜ê²½ ì„¤ì • ê²€ì¦
    runs-on: ubuntu-latest
    outputs:
      environment: ${{ steps.determine-env.outputs.environment }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: í™˜ê²½ ê²°ì •
        id: determine-env
        run: |
          if [[ "${{ github.ref }}" == "refs/heads/main" ]]; then
            echo "environment=prod" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == "refs/heads/develop" ]]; then
            echo "environment=test" >> $GITHUB_OUTPUT
          else
            echo "environment=dev" >> $GITHUB_OUTPUT
          fi

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: í™˜ê²½ ì„¤ì • ê²€ì¦
        run: |
          node apps/server/infrastructure/scripts/env-check.js ${{ steps.determine-env.outputs.environment }}

  # ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
  code-quality:
    name: ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
    runs-on: ubuntu-latest
    needs: validate-environment
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Lint check
        run: pnpm run lint:all

      - name: Type check
        run: pnpm run type-check:all

      - name: Format check
        run: pnpm run format:all --check

  # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
  unit-tests:
    name: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    needs: validate-environment
    strategy:
      matrix:
        package: [client, server]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Run tests - ${{ matrix.package }}
        run: pnpm run test:${{ matrix.package }}

      - name: Upload coverage reports
        uses: codecov/codecov-action@v4
        with:
          directory: ./apps/${{ matrix.package }}/coverage
          flags: ${{ matrix.package }}
          name: ${{ matrix.package }}-coverage
        continue-on-error: true

  # E2E í…ŒìŠ¤íŠ¸
  e2e-tests:
    name: E2E í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    needs: [validate-environment, unit-tests]
    if: github.event_name == 'push' && (github.ref == 'refs/heads/develop' || github.ref == 'refs/heads/main')
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Install Playwright browsers
        run: pnpm --filter @vive/client exec playwright install --with-deps

      - name: Build application
        run: pnpm run build:all

      - name: Start development server
        run: |
          pnpm run dev &
          sleep 10

      - name: Run E2E tests
        run: pnpm run test:e2e

      - name: Upload E2E test results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: e2e-test-results
          path: apps/client/test-results/
          retention-days: 7

  # ë¹Œë“œ ê²€ì¦
  build-validation:
    name: ë¹Œë“œ ê²€ì¦
    runs-on: ubuntu-latest
    needs: [validate-environment, code-quality]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Build all packages
        run: pnpm run build:all

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-artifacts-${{ needs.validate-environment.outputs.environment }}
          path: |
            apps/client/dist/
            apps/server/dist/
            apps/server/infrastructure/dist/
          retention-days: 7

  # ë³´ì•ˆ ê²€ì‚¬ ê°•í™”
  security-scan:
    name: ë³´ì•ˆ ê²€ì‚¬
    runs-on: ubuntu-latest
    needs: validate-environment
    permissions:
      actions: read
      contents: read
      security-events: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: ì˜ì¡´ì„± ë³´ì•ˆ ê°ì‚¬
        run: |
          echo "ðŸ” ì˜ì¡´ì„± ë³´ì•ˆ ê²€ì‚¬ ì‹¤í–‰ ì¤‘..."
          pnpm audit --audit-level moderate --json > audit-report.json || true

          # ì‹¬ê°í•œ ì·¨ì•½ì ì´ ìžˆëŠ”ì§€ í™•ì¸
          CRITICAL_VULNS=$(cat audit-report.json | jq '.vulnerabilities | to_entries | map(select(.value.severity == "critical")) | length')
          HIGH_VULNS=$(cat audit-report.json | jq '.vulnerabilities | to_entries | map(select(.value.severity == "high")) | length')

          echo "Critical vulnerabilities: $CRITICAL_VULNS"
          echo "High vulnerabilities: $HIGH_VULNS"

          if [[ "$CRITICAL_VULNS" -gt 0 ]]; then
            echo "âŒ Critical ì·¨ì•½ì ì´ ë°œê²¬ë˜ì–´ ë°°í¬ë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤."
            exit 1
          elif [[ "$HIGH_VULNS" -gt 5 ]]; then
            echo "âš ï¸ High ì·¨ì•½ì ì´ ë„ˆë¬´ ë§ŽìŠµë‹ˆë‹¤ ($HIGH_VULNSê°œ). ìˆ˜ë™ ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤."
            exit 1
          fi

      - name: OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@main
        with:
          project: "hanbit-vibecoding"
          path: "."
          format: "JSON"
          args: >
            --enableRetired
            --enableExperimental
            --failOnCVSS 7
        continue-on-error: true

      - name: CodeQL ë¶„ì„ ì´ˆê¸°í™”
        uses: github/codeql-action/init@v3
        with:
          languages: javascript,typescript
          queries: security-extended,security-and-quality

      - name: CodeQL ìžë™ ë¹Œë“œ
        uses: github/codeql-action/autobuild@v3

      - name: CodeQL ë¶„ì„ ìˆ˜í–‰
        uses: github/codeql-action/analyze@v3
        with:
          category: "/language:javascript"

      - name: ë³´ì•ˆ ê²€ì‚¬ ê²°ê³¼ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: security-scan-results
          path: |
            audit-report.json
            reports/
          retention-days: 30

  # í”„ë¡ íŠ¸ì—”ë“œ GitHub Pages ë°°í¬
  deploy-frontend:
    name: í”„ë¡ íŠ¸ì—”ë“œ GitHub Pages ë°°í¬
    runs-on: ubuntu-latest
    needs:
      - validate-environment
      - code-quality
      - unit-tests
      - build-validation
      - production-approval
    if: |
      github.event_name == 'push' && github.ref == 'refs/heads/main' &&
      (needs.production-approval.result == 'success' || needs.production-approval.result == 'skipped') &&
      !cancelled()
    permissions:
      contents: read
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    concurrency:
      group: "pages"
      cancel-in-progress: false
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Build frontend for production
        run: |
          pnpm --filter @vive/client build
        env:
          NODE_ENV: production
          VITE_API_URL: ${{ secrets.VITE_API_URL }}

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload to GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: "apps/client/dist"

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: Frontend ë°°í¬ ì™„ë£Œ ì•Œë¦¼
        if: success()
        run: |
          echo "âœ… GitHub Pages ë°°í¬ ì„±ê³µ!"
          echo "ì‚¬ì´íŠ¸ URL: ${{ steps.deployment.outputs.page_url }}"
          echo "ë°°í¬ ì‹œê°„: $(date)"
          echo "ì»¤ë°‹: ${{ github.sha }}"

  # í”„ë¡œë•ì…˜ ë°°í¬ ìŠ¹ì¸ ëŒ€ê¸°
  production-approval:
    name: í”„ë¡œë•ì…˜ ë°°í¬ ìŠ¹ì¸ ëŒ€ê¸°
    runs-on: ubuntu-latest
    needs:
      - validate-environment
      - code-quality
      - unit-tests
      - build-validation
      - security-scan
      - e2e-tests
    if: github.event_name == 'push' && github.ref == 'refs/heads/main' && needs.validate-environment.outputs.environment == 'prod'
    environment:
      name: production-approval
    steps:
      - name: ìŠ¹ì¸ ëŒ€ê¸° ë©”ì‹œì§€
        run: |
          echo "ðŸš€ í”„ë¡œë•ì…˜ ë°°í¬ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
          echo "ì»¤ë°‹: ${{ github.sha }}"
          echo "ë°°í¬ ì˜ˆì • ì‹œê°„: $(date)"
          echo "GitHub ì €ìž¥ì†Œì—ì„œ ìŠ¹ì¸ìžê°€ ìŠ¹ì¸í•˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤."

  # ë°±ì—”ë“œ AWS ë°°í¬ (develop/main ë¸Œëžœì¹˜ë§Œ)
  deploy-backend:
    name: ë°±ì—”ë“œ ë°°í¬ - ${{ needs.validate-environment.outputs.environment }}
    runs-on: ubuntu-latest
    needs:
      - validate-environment
      - code-quality
      - unit-tests
      - build-validation
      - security-scan
      - production-approval
    if: |
      github.event_name == 'push' && 
      (github.ref == 'refs/heads/develop' || 
       (github.ref == 'refs/heads/main' && needs.production-approval.result == 'success')) &&
      !cancelled()
    environment:
      name: ${{ needs.validate-environment.outputs.environment }}
      url: ${{ steps.get-api-url.outputs.api_url }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ vars.AWS_DEFAULT_REGION || 'us-east-1' }}
          role-to-assume: ${{ secrets.AWS_DEPLOYMENT_ROLE_ARN }}
          role-session-name: GitHubActions-${{ github.run_id }}
          role-duration-seconds: 3600

      - name: ë°°í¬ ì „ ê²€ì¦
        run: node apps/server/infrastructure/scripts/pre-deploy.js ${{ needs.validate-environment.outputs.environment }}

      - name: CDK Bootstrap (í•„ìš”ì‹œ)
        run: |
          cd apps/server/infrastructure
          pnpm install --frozen-lockfile
          npx cdk bootstrap aws://${{ secrets.AWS_ACCOUNT_ID }}/${{ vars.AWS_DEFAULT_REGION || 'us-east-1' }} --context environment=${{ needs.validate-environment.outputs.environment }}
        continue-on-error: true

      - name: CDK Diff í™•ì¸
        id: cdk-diff
        run: |
          cd apps/server/infrastructure
          echo "::group::CDK Diff Output"
          npx cdk diff --context environment=${{ needs.validate-environment.outputs.environment }} || true
          echo "::endgroup::"

      - name: CDK ë°°í¬
        id: cdk-deploy
        run: |
          cd apps/server/infrastructure
          chmod +x scripts/deploy.sh
          ./scripts/deploy.sh ${{ needs.validate-environment.outputs.environment }} --require-approval never
        timeout-minutes: 30

      - name: API URL ì¶”ì¶œ
        id: get-api-url
        run: |
          cd apps/server/infrastructure
          API_URL=$(npx cdk output --context environment=${{ needs.validate-environment.outputs.environment }} HanbitStackApiUrl 2>/dev/null || echo "")
          echo "api_url=${API_URL}" >> $GITHUB_OUTPUT
          echo "ë°°í¬ëœ API URL: ${API_URL}"

      - name: ë°°í¬ í›„ ê²€ì¦
        run: |
          node apps/server/infrastructure/scripts/post-deploy.js ${{ needs.validate-environment.outputs.environment }}

      - name: API í—¬ìŠ¤ì²´í¬
        run: |
          API_URL="${{ steps.get-api-url.outputs.api_url }}"
          if [[ -n "$API_URL" ]]; then
            echo "API í—¬ìŠ¤ì²´í¬ ì‹¤í–‰ ì¤‘: $API_URL/health"
            for i in {1..5}; do
              if curl -f "$API_URL/health" --max-time 30; then
                echo "âœ… API í—¬ìŠ¤ì²´í¬ ì„±ê³µ ($i/5)"
                break
              else
                echo "âš ï¸ API í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ ($i/5), 30ì´ˆ í›„ ìž¬ì‹œë„..."
                sleep 30
              fi
              if [[ $i -eq 5 ]]; then
                echo "âŒ API í—¬ìŠ¤ì²´í¬ ìµœì¢… ì‹¤íŒ¨"
                exit 1
              fi
            done
          else
            echo "âš ï¸ API URLì„ ì°¾ì„ ìˆ˜ ì—†ì–´ í—¬ìŠ¤ì²´í¬ë¥¼ ê±´ë„ˆëœ¡ë‹ˆë‹¤."
          fi

      - name: ë°°í¬ ì„±ê³µ ì•Œë¦¼
        if: success()
        run: |
          echo "âœ… ${{ needs.validate-environment.outputs.environment }} í™˜ê²½ ë°°í¬ ì„±ê³µ!"
          echo "ë°°í¬ ì‹œê°„: $(date)"
          echo "ì»¤ë°‹: ${{ github.sha }}"

      - name: ë°°í¬ ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
        if: failure() && steps.cdk-deploy.conclusion == 'failure'
        run: |
          echo "âŒ ë°°í¬ ì‹¤íŒ¨. ìžë™ ë¡¤ë°±ì„ ì‹œë„í•©ë‹ˆë‹¤..."
          cd apps/server/infrastructure
          echo "yes" | node scripts/rollback.js ${{ needs.validate-environment.outputs.environment }}
          echo "ðŸ”„ ë¡¤ë°± ì™„ë£Œ"

  # Slack/Discord ì•Œë¦¼
  notify:
    name: ë°°í¬ ê²°ê³¼ ì•Œë¦¼
    runs-on: ubuntu-latest
    needs: [validate-environment, deploy-backend, deploy-frontend]
    if: always() && (github.event_name == 'push' && (github.ref == 'refs/heads/develop' || github.ref == 'refs/heads/main'))
    steps:
      - name: Slack ì•Œë¦¼ (ì„±ê³µ)
        if: needs.deploy-backend.result == 'success' || needs.deploy-frontend.result == 'success'
        uses: 8398a7/action-slack@v3
        with:
          status: success
          channel: "#deployment"
          text: |
            ðŸŽ‰ **ë°°í¬ ì„±ê³µ!**
            - í™˜ê²½: `${{ needs.validate-environment.outputs.environment }}`
            - ì»¤ë°‹: `${{ github.sha }}`
            - ë¸Œëžœì¹˜: `${{ github.ref_name }}`
            - ë°°í¬ ì‹œê°„: $(date)
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        continue-on-error: true

      - name: Slack ì•Œë¦¼ (ì‹¤íŒ¨)
        if: needs.deploy-backend.result == 'failure' || needs.deploy-frontend.result == 'failure'
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          channel: "#deployment"
          text: |
            âŒ **ë°°í¬ ì‹¤íŒ¨!**
            - í™˜ê²½: `${{ needs.validate-environment.outputs.environment }}`
            - ì»¤ë°‹: `${{ github.sha }}`
            - ë¸Œëžœì¹˜: `${{ github.ref_name }}`
            - ì‹¤íŒ¨ ì‹œê°„: $(date)
            - ë¡¤ë°± ì‹¤í–‰ë¨
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        continue-on-error: true

      - name: Discord ì•Œë¦¼ (ì„±ê³µ)
        if: needs.deploy-backend.result == 'success' || needs.deploy-frontend.result == 'success'
        uses: Ilshidur/action-discord@master
        with:
          args: |
            ðŸŽ‰ **ë°°í¬ ì„±ê³µ!**
            í™˜ê²½: `${{ needs.validate-environment.outputs.environment }}`
            ì»¤ë°‹: `${{ github.sha }}`
            ë¸Œëžœì¹˜: `${{ github.ref_name }}`
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        continue-on-error: true

      - name: Discord ì•Œë¦¼ (ì‹¤íŒ¨)
        if: needs.deploy-backend.result == 'failure' || needs.deploy-frontend.result == 'failure'
        uses: Ilshidur/action-discord@master
        with:
          args: |
            âŒ **ë°°í¬ ì‹¤íŒ¨!**
            í™˜ê²½: `${{ needs.validate-environment.outputs.environment }}`
            ì»¤ë°‹: `${{ github.sha }}`
            ë¸Œëžœì¹˜: `${{ github.ref_name }}`
            ë¡¤ë°± ì‹¤í–‰ë¨
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        continue-on-error: true

  # ë°°í¬ í›„ ê²€ì¦ (ë³„ë„ ìž‘ì—…)
  post-deployment-validation:
    name: ë°°í¬ í›„ í†µí•© ê²€ì¦
    runs-on: ubuntu-latest
    needs: [validate-environment, deploy-backend]
    if: github.event_name == 'push' && (github.ref == 'refs/heads/develop' || github.ref == 'refs/heads/main')
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_DEFAULT_REGION }}

      - name: í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        run: |
          # ë°°í¬ëœ í™˜ê²½ì— ëŒ€í•œ í†µí•© í…ŒìŠ¤íŠ¸
          echo "ë°°í¬ëœ API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ì¤‘..."

          # API ì—”ë“œí¬ì¸íŠ¸ ê¸°ë³¸ í…ŒìŠ¤íŠ¸
          API_URL=$(cd apps/server/infrastructure && npx cdk output --context environment=${{ needs.validate-environment.outputs.environment }} HanbitStackApiUrl 2>/dev/null || echo "")
          if [[ -n "$API_URL" ]]; then
            echo "API ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
            
            # Health check
            curl -f "$API_URL/health" --max-time 30
            
            # TODO API ìˆ˜ì • ì‹œ ì£¼ì„ í•´ì œ
            # curl -f "$API_URL/api/todos" -H "Authorization: Bearer test-token" --max-time 30
            
            echo "âœ… API í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ"
          else
            echo "âš ï¸ API URLì„ ì°¾ì„ ìˆ˜ ì—†ì–´ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤."
          fi

      - name: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„¤ì • í™•ì¸
        run: |
          echo "CloudWatch ëŒ€ì‹œë³´ë“œ ë° ì•ŒëžŒ ìƒíƒœ í™•ì¸ ì¤‘..."
          aws cloudwatch describe-alarms --query 'MetricAlarms[?StateValue!=`OK`]'

      - name: ë³´ì•ˆ ê·œì • ì¤€ìˆ˜ í™•ì¸
        run: |
          echo "AWS Config ë³´ì•ˆ ê·œì¹™ í™•ì¸ ì¤‘..."
          aws configservice get-compliance-summary-by-config-rule --region ${{ vars.AWS_DEFAULT_REGION || 'us-east-1' }} || true

      - name: ë°°í¬ ê²°ê³¼ ìš”ì•½
        run: |
          echo "## ë°°í¬ ì™„ë£Œ ìš”ì•½" >> $GITHUB_STEP_SUMMARY
          echo "- í™˜ê²½: ${{ needs.validate-environment.outputs.environment }}" >> $GITHUB_STEP_SUMMARY
          echo "- ë°°í¬ ì‹œê°„: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- ì»¤ë°‹: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "- ë¸Œëžœì¹˜: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
